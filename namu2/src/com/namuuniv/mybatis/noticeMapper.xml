<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="notice">

	<!-- 전체 공지글 수 조회-->
	<select id="totalNoticeCount" resultType="int">
		SELECT COUNT(*) AS CNT FROM NOTICE
	</select>
	
	<!-- 페이지에 해당하는 공지글 조회 -->
	<select id="noticeList" parameterType="map" resultType="com.namuuniv.vo.NoticeVO">
	<![CDATA[
		SELECT R.R_NUM, R.ID, R.TITLE, R.CONTENT, R.VIEWS,
		       R.CREATED, R.NAME AS staffName
		FROM (SELECT ROWNUM R_NUM, N.*
		      FROM (SELECT N.*, S.NAME
		            FROM NOTICE N
		            JOIN STAFF S ON N.STAFF_ID = S.ID
		            ORDER BY N.ID DESC
		            )N
		      WHERE ROWNUM <= #{end}
		      )R
		WHERE R.R_NUM >= #{begin}
	]]>
	</select>
	
	<!-- 공지글 1개 조회(상세보기) -->
	<select id="noticeDetail" parameterType="int" resultType="com.namuuniv.vo.NoticeVO">
		SELECT ID, STAFF_ID, TITLE, CONTENT, VIEWS, CREATED
		FROM NOTICE WHERE ID = #{id}
	</select>
	
	<!-- 공지글 조회수 증가 -->
	<update id="updateViews" parameterType="int">
		UPDATE NOTICE
		SET VIEWS = VIEWS + 1
		WHERE ID = #{id}
	</update>

</mapper>
