<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="grade">
	<!-- (교수)강의 - 내 강의 조회 -->
	<select id="proSubList" resultType="ProSubjectVO">
		SELECT S.Id AS SUB_ID, S.YEAR, S.SEMESTER, D.NAME AS DEPT_NAME,
			   S.NAME AS SUB_NAME, S.ROOM, S.GRADES, S.TYPE, S.TIME
		FROM SUBJECT S, DEPARTMENT D
		WHERE S.DEPT_ID = D.ID 
		AND S.PROFESSOR_ID = #{id}
	</select>
	
	<!-- (교수)강의 - 수강중인 학생 목록 -->
	<select id="enrollStuList" parameterType="EnrollStuVO" resultType="EnrollStuVO">
 		SELECT ROW_NUMBER() OVER (ORDER BY S.ID) AS IDX, S.GRADE, S.ID AS STU_ID,
		       S.SEMESTER, D.NAME AS DEPT_NAME, S.NAME AS STU_NAME, S.TEL, S.GENDER 
		FROM STUDENT S
		  JOIN ENROLMENT E ON S.ID = E.STU_ID
		  JOIN SUBJECT T ON E.SUB_ID = T.ID
		  JOIN DEPARTMENT D ON S.DEPT_ID = D.ID
		WHERE 
		  T.PROFESSOR_ID = #{userId}
		  AND T.NAME = #{subName}
		ORDER BY 
		  S.ID
	</select>
	
	<!-- 성적 조회 -->
	<select id="searchRate" parameterType="EnrollStuVO" resultType="EnrollStuVO">
		SELECT G.RATE 
		FROM GRADE G, SUBJECT T
		WHERE G.SUB_ID = T.ID
		AND G.STU_ID = #{userId}
		AND T.NAME = #{subName};
	</select>
	
	<select id="infoGrade" parameterType="EnrollStuVO" resultType="EnrollStuVO">
		SELECT G.RATE 
		FROM GRADE G, SUBJECT T
		WHERE G.SUB_ID = T.ID
		AND G.STU_ID = #{userId}
		AND T.NAME = #{subName};
	</select>
	
	<!-- (교수)성적 테이블에 존재여부 확인 -->
	<select id="selectGrade">
	
	</select>
	
	<!-- (교수)성적 입력 -->
	<insert id="insertGrade">
		INSERT INTO GRADE (ID, STU_ID, SUB_ID, ABSENT, 
			   MID_EXAM, FIN_EXAM, EX_SCORE, RATE) 
		VALUES (GRADE_SEQ.NEXTVAL, #{gradeId}, #{subID}, 
			   #{absent}, #{midExam}, #{finExam}, #{exScore}, #{rate});
	</insert>
	
	<!-- (학생)강의 - 내 강의 조회 (성적제외)-->
	<select id="stuSubList">
		SELECT S.ID AS STU_ID, T.YEAR AS YEAR, T.SEMESTER AS SEMESTER, T.NAME AS NAME, G.RATE  
		FROM STUDENT S, SUBJECT T, ENROLMENT E, GRADE G
		WHERE S.ID = E.STU_ID
		AND E.SUB_ID = T.ID
		AND G.STU_ID = S.ID
		AND G.SUB_ID = T.ID
		AND S.ID = #{id};
	</select>
</mapper>